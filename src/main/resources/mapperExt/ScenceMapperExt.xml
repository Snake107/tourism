<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ssm.dao.mappingExt.ScenceMapperExt" >

    <select id="getScenceNavi" parameterType="com.ssm.dto.ScenceNaviParameter" resultType="com.ssm.vo.ScenceNavi">
        SELECT
            a.*,
        IF
            ( ISNULL( b.hotel_num ), 0, b.hotel_num ) hotel_num,
        IF
            ( ISNULL( c.restaurant_num ), 0, c.restaurant_num ) restaurant_num
        FROM
            t_city a
            LEFT JOIN ( SELECT city_id, count(*) hotel_num FROM t_hotel GROUP BY city_id ) b ON a.id = b.city_id
            LEFT JOIN ( SELECT city_id, count(*) restaurant_num FROM t_restaurant GROUP BY city_id ) c ON a.id = c.city_id
        <if test="orderBy!=null and orderBy!=''">
            order by #{orderBy}
        </if>
        <if test="limit!=null and limit!=''">
            limit #{limit}
        </if>
    </select>

    <select id="selectIndexSixScenceInfo" resultType="com.ssm.pojo.ext.ScenceExt">
		SELECT
			t_sc.id,
			t_sc.scence_name,
			t_sc.description,
			t_sc.price,
			t_sc.picture,
			t_sc.p_type,
			t_sc.mark,
			t_sc.views,
			t_tag.tag_name,
			COUNT( t_comme.id ) AS reviews
		FROM
			t_scence AS t_sc
			LEFT JOIN t_commodity_tag AS t_comm ON t_sc.id = t_comm.commodity_id
			AND t_sc.p_type = t_comm.big_type
			LEFT JOIN t_tags t_tag ON t_tag.id = t_comm.tag_id
			LEFT JOIN t_comment AS t_comme ON t_sc.id = t_comme.commodity_id
			AND t_sc.p_type = t_comme.big_type
			AND t_sc.flag = 1
			AND t_tag.flag = 1
			AND t_comm.flag = 1
			AND t_comme.flag = 1
		GROUP BY
			t_sc.id
		ORDER BY
			t_sc.mark DESC
		LIMIT 0,6;
	</select>

</mapper>